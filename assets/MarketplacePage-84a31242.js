import{j as e,u as W,r as p,B as P,Q as O,h as R,b as z,A as B,w as V,e as $,d as Q,p as T,I as G,C as H}from"./index-29ebecb4.js";import{H as D}from"./Helmet-3f1c463b.js";import{R as M,C}from"./Col-7106f25e.js";import{A as K}from"./Alert-53afee14.js";import{S as U,F as q}from"./FilterPanel-ecbb19ac.js";import{F as y,L as w}from"./Label-25c4d9a0.js";import{I as F}from"./Input-092d3532.js";import{I as X,X as Y}from"./x-d20e24f6.js";import{c as J}from"./currency-symbol-map-2c95d993.js";import{i as L}from"./isNullOrWhiteSpace-3eb5922e.js";import{M as Z,a as _,b as ee}from"./ModalBody-4728dbd0.js";import{M as se}from"./ModalFooter-8a832faf.js";import{g as re}from"./getTimezoneOffset-4655d392.js";import{L as te}from"./Listing-17dd21fe.js";import{g as ae,P as oe}from"./Pagination-f8b1ecd4.js";import{S as ne}from"./Spinner-99079439.js";import{t as ce}from"./toQuery-95abe6fa.js";import"./floating-ui.dom-b7824c3c.js";import"./jewelleryClasses-0e5a29b0.js";import"./CardBody-f79b7743.js";import"./SelectQuantity-b1a09a6a.js";import"./types-9dadba29.js";import"./Currency-9311fda6.js";import"./strings-0c217f2f.js";import"./UnitType-2ae5b94b.js";import"./Badge-dcfa0ac5.js";import"./CardImg-0d61cdbd.js";import"./CardText-9b22f762.js";import"./ButtonGroup-cb6cbaf6.js";const ie=({currencies:t,onChange:s})=>{const o=Object.entries(J).map(([r,c])=>({value:r,label:r,symbol:c})),n=r=>{s(r.map(c=>c.value))},i={multiValue:r=>({...r,backgroundColor:"#e9ecef"}),multiValueLabel:r=>({...r,color:"#495057"}),multiValueRemove:r=>({...r,color:"#495057",":hover":{backgroundColor:"#ced4da",color:"#495057"}})},h=({value:r,symbol:c})=>e.jsxs("div",{children:[r," ",c]});return e.jsxs(y,{children:[e.jsx(w,{for:"currencySelect",children:"Currencies"}),e.jsx(U,{id:"currencySelect",isMulti:!0,options:o,value:o.filter(r=>t.includes(r.value)),onChange:n,styles:i,formatOptionLabel:h,placeholder:"Select currencies..."})]})},le=()=>W("/api/save-search",{errorMessage:"Failed to save search"}),de=({searchToSave:t,onClose:s})=>{const[o,n]=p.useState(!1),i=[t.handle,t.search].map(l=>(l||"").trim()).filter(l=>!L(l)).join(" "),h=i.length>32?i.substring(0,32).split(" ").slice(0,-1).join(" ")+"...":i,[r,c]=p.useState(h),f=le(),v=async()=>{n(!0);const l={...t,name:r};try{await f(l),O.success("Search was saved"),window.dispatchEvent(new Event("savedSearchesChanged")),s()}catch(u){O.error(R(u))}finally{n(!1)}};return e.jsxs(Z,{isOpen:!0,toggle:s,size:"lg",children:[e.jsx(_,{toggle:s,children:"Save search"}),e.jsxs(ee,{children:[e.jsxs(y,{children:[e.jsx(w,{for:"searchName",children:"Search name"}),e.jsx(F,{id:"searchName",type:"text",placeholder:"Search name",value:r,onChange:l=>c(l.target.value),maxLength:32,className:"mb-3"})]}),e.jsxs(y,{children:[e.jsx(w,{className:"fw-bold",children:"Search"}),e.jsx("p",{children:t.name})]}),e.jsxs(y,{children:[e.jsx(w,{className:"fw-bold",children:"Store"}),e.jsx("p",{children:t.handle})]}),e.jsxs(y,{children:[e.jsx(w,{className:"fw-bold",children:"Include sold"}),e.jsx("p",{children:t.includeSold?"YES":"NO"})]})]}),e.jsxs(se,{children:[e.jsx(P,{color:"secondary",onClick:s,children:"Close"}),e.jsx(P,{color:"primary",onClick:v,disabled:o,children:o?"Submitting...":"Submit"})]})]})},he=({handle:t,filters:s,onFilterChange:o})=>{const{isAuthenticated:n}=z(),[i,h]=p.useState(s.search||""),[r,c]=p.useState(null),f=!L(s.search)||!L(s.category)||s.condition&&s.condition.length>0||s.era&&s.era.length>0||s.jewellery&&s.jewellery.length>0,v=n&&f,l=()=>{c({id:null,timezoneOffset:re(),name:"",handle:t,search:s.search,category:s.category,condition:s.condition,era:s.era,jewellery:s.jewellery,includeSold:s.includeSold})},u=()=>{o({search:i})},k=()=>{h(""),o({search:""})},x=d=>{d.key==="Enter"&&u()};return e.jsxs(e.Fragment,{children:[r&&e.jsx(de,{onClose:()=>c(null),searchToSave:r}),e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex-grow-1",style:{minWidth:"200px",maxWidth:"400px"},children:e.jsxs(X,{children:[e.jsx(P,{id:"ClearSearch",onClick:k,children:e.jsx(Y,{size:18})}),e.jsx(F,{value:i,onChange:d=>h(d.target.value),onKeyPress:x,placeholder:"Search for..."}),e.jsx(P,{color:"primary",onClick:u,children:e.jsx(B,{size:18})})]})}),e.jsx("div",{children:e.jsxs(y,{check:!0,className:"mb-0",children:[e.jsx(F,{type:"checkbox",id:"showSoldItems",checked:s.includeSold||!1,onChange:d=>o({includeSold:d.target.checked})}),e.jsx(w,{check:!0,for:"showSoldItems",className:"mb-0",children:"Show sold items"})]})}),e.jsx("div",{style:{minWidth:"200px",maxWidth:"300px"},children:e.jsx(ie,{currencies:s.currencies||[],onChange:d=>o({currencies:d})})}),v&&e.jsx("div",{children:e.jsx(P,{size:"sm",onClick:l,children:"Save this search"})})]})]})},me=t=>{const{filters:s={category:"",eras:[],conditions:[],jewellery:[]},...o}=t,n=ce({...o,...s});return V(`/api/browse?${n}`,{errorMessage:"Failed to browse items"})},Te=({handle:t})=>{const s=$(),o=Q(),[n,i]=p.useState({}),[h,r]=p.useState(1),[c,f]=p.useState(ae()),v=a=>{r(1),f(a)},l=()=>{var b,g,N,j;const a=new URLSearchParams(o.search);return{category:a.get("category")||void 0,condition:((b=a.get("condition"))==null?void 0:b.split(","))||void 0,era:((g=a.get("era"))==null?void 0:g.split(","))||void 0,jewellery:((N=a.get("jewellery"))==null?void 0:N.split(","))||void 0,search:a.get("search")||void 0,includeSold:a.get("includeSold")==="true"||void 0,currencies:((j=a.get("currencies"))==null?void 0:j.split(","))||void 0}};p.useEffect(()=>{i(l()),r(1)},[o.search]);const u=a=>{const b={...n,...a};i(b);const g=new URLSearchParams;Object.entries(b).forEach(([j,S])=>{S&&j!=="handle"&&(Array.isArray(S)?g.set(j,S.join(",")):typeof S=="boolean"?g.set(j,S.toString()):g.set(j,S))});const N=g.toString();s({search:N})},k=me({handle:t==="@everyone"?void 0:t,filters:n,page:h,perPage:c}),{data:x,error:d,isLoading:A}=T(["browse",n,h,c],k,{keepPreviousData:!0}),m=G.find(a=>a.path===n.category),E="Vintage and Pre-Owned"+(m?` - ${m.value}`:" - Marketplace"),I="Vintage and Pre-Owned"+(m?` - ${m.value} - ${m.explanation}`:" - Marketplace");return e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx("title",{children:E}),e.jsx("meta",{property:"og:title",content:E}),e.jsx("meta",{property:"og:description",content:I}),e.jsx("meta",{property:"og:url",content:window.location.href}),e.jsx("meta",{property:"og:type",content:"website"})]}),e.jsxs(H,{fluid:!0,children:[e.jsx(M,{className:"mb-3",children:e.jsx(C,{xs:"12",children:e.jsxs("h1",{className:"text-center",children:["Marketplace / ",(m==null?void 0:m.value)??"..."]})})}),e.jsx(M,{className:"mb-3 align-items-center",children:e.jsx(C,{xs:"12",md:"9",children:e.jsx(he,{handle:t==="@everyone"?null:t,filters:n,onFilterChange:u})})}),e.jsxs(M,{children:[e.jsx(C,{xs:"12",md:"3",children:e.jsx(q,{onFilterChange:u,filters:n})}),e.jsxs(C,{xs:"12",md:"9",children:[A?e.jsx(ne,{}):d?e.jsx(K,{color:"danger",children:R(d)}):e.jsx(M,{children:x==null?void 0:x.items.map(a=>e.jsx(C,{xs:"12",sm:"6",lg:"4",xl:"3",className:"mb-4",children:e.jsx(te,{item:a,showCheckout:!1})},a.id))}),x&&e.jsx(oe,{pagedResult:x,onPageSelected:r,perPage:c,onPerPageSelected:v})]})]})]})]})};export{Te as default};
