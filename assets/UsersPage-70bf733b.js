import{_ as L,R as m,a as N,j as e,B as S,u as R,r as c,y as A,Q as w,w as B,b as W,p as z}from"./index-660d126b.js";import{T as $}from"./Table-cbaeae2a.js";import{S as I}from"./Spinner-f4f30a5b.js";import{E as M}from"./ErrorDisplay-52780e50.js";import{g as O,P as T}from"./Pagination-a5b0422f.js";import{S as _}from"./Search-68c612fa.js";import{S as G}from"./StatusButtons-01a826e5.js";import{M as H,a as D,b as Q}from"./ModalBody-ed0339e4.js";import{M as V}from"./ModalFooter-601f690c.js";import{F as u,L as h}from"./Label-4c846b7c.js";import{I as f}from"./Input-fbe04029.js";import{B as Y}from"./ButtonGroup-07933ff6.js";import{S as k}from"./types-9dadba29.js";import{u as F}from"./useMutation-e7c8b84b.js";import{b as q}from"./strings-3be1ab26.js";import"./Alert-e5aa8ee6.js";import"./Card-0007d0c0.js";import"./CardBody-ff2bad32.js";import"./x-a6635ec2.js";var J=["size","color"];function K(s){var i=s.size,a=i===void 0?24:i,r=s.color,n=r===void 0?"currentColor":r,t=L(s,J);return m.createElement("svg",N({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-click",width:a,height:a,viewBox:"0 0 24 24",stroke:n,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},t),m.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),m.createElement("line",{x1:"3",y1:"12",x2:"6",y2:"12"}),m.createElement("line",{x1:"12",y1:"3",x2:"12",y2:"6"}),m.createElement("line",{x1:"7.8",y1:"7.8",x2:"5.6",y2:"5.6"}),m.createElement("line",{x1:"16.2",y1:"7.8",x2:"18.4",y2:"5.6"}),m.createElement("line",{x1:"7.8",y1:"16.2",x2:"5.6",y2:"18.4"}),m.createElement("path",{d:"M12 12l9 3l-4 2l-2 4l-3 -9"}))}const X=({options:s,label:i,selectedItems:a,setSelectedItems:r})=>{const n=(t,o)=>{t.currentTarget.checked?r([o,...a]):r(a.filter(d=>d!==o))};return e.jsx(e.Fragment,{children:s.map((t,o)=>e.jsxs(u,{check:!0,children:[e.jsx(f,{type:"checkbox",id:`checkbox-${o}`,checked:a.includes(t),onChange:d=>n(d,t)}),e.jsx(h,{check:!0,for:`checkbox-${o}`,children:typeof i=="function"?i(t):String(t)})]},`Check_${o}`))})},Z=({status:s,setStatus:i,className:a})=>{const r=[{value:k.Active,label:"Active"},{value:k.Archived,label:"Archived"}],n=t=>{i(t)};return e.jsx(Y,{className:a,children:r.map(t=>e.jsx(S,{color:t.value===s?"primary":"secondary",onClick:()=>n(t.value),children:t.label},t.value))})},ee=()=>R("/api/send-email-confirmation-email",{errorMessage:"Failed to send email confirmation email"}),se=()=>R("/api/update-user",{errorMessage:"Failed to update user"}),te=({user:s})=>{const i=ee(),{mutate:a,isLoading:r,error:n}=F(i,{onSuccess:()=>{w.success("Email was sent")}});return e.jsxs("div",{children:[e.jsx(M,{error:n,title:"Error sending email confirmation email",onDismiss:()=>{}}),e.jsx(S,{onClick:()=>a({userId:s.id}),disabled:r,children:"Resend confirmation email"})]})},re=({user:s,setUser:i,onUserWasUpdated:a})=>{const[r,n]=c.useState(s.status),[t,o]=c.useState(s.roles),[d,C]=c.useState(s.email),[x,E]=c.useState(s.emailConfirmed),[v,U]=c.useState(!1),j=se(),{mutate:y,isLoading:P,error:b}=F(j,{onSuccess:()=>{U(!0),w.success("User was updated")}}),p=()=>{i(null),v&&a()},l=()=>{y({userId:s.id,emailConfirmed:x,userRoleNames:t,status:r})};return e.jsxs(H,{isOpen:!0,toggle:p,size:"lg",children:[e.jsx(D,{toggle:p,children:s.handle}),e.jsxs(Q,{children:[e.jsxs(u,{children:[e.jsx(h,{for:"handle",children:"Handle"}),e.jsx(f,{id:"handle",defaultValue:s.handle,readOnly:!0,disabled:!0})]}),e.jsx(u,{children:s.emailConfirmed?e.jsxs("div",{children:[e.jsx(h,{for:"email",children:"Email"}),e.jsx(f,{id:"email",type:"email",defaultValue:s.email,readOnly:!0,disabled:!0}),e.jsx("small",{className:"text-muted",children:"Email is confirmed"})]}):e.jsxs("div",{children:[e.jsx(h,{for:"email",children:"Email"}),e.jsx(f,{id:"email",type:"email",value:d,onChange:g=>C(g.target.value)})]})}),!s.emailConfirmed&&e.jsxs(e.Fragment,{children:[e.jsx(u,{check:!0,children:e.jsxs(h,{check:!0,children:[e.jsx(f,{type:"checkbox",checked:x,onChange:g=>E(g.target.checked)})," ","Confirm email"]})}),e.jsx(te,{user:s})]}),e.jsxs(u,{children:[e.jsx(h,{children:"Roles"}),e.jsx(X,{options:A.All,label:g=>g,selectedItems:t,setSelectedItems:o})]}),e.jsxs(u,{children:[e.jsx(h,{children:"Status"}),e.jsx(Z,{status:r,setStatus:n})]}),e.jsx(M,{error:b})]}),e.jsxs(V,{children:[e.jsx(S,{color:"secondary",onClick:p,children:"Close"})," ",e.jsx(S,{color:"primary",onClick:l,disabled:P,children:"Submit"})]})]})},ae=(s,i,a,r)=>{const n=new URLSearchParams;return n.append("page",String(s)),n.append("perPage",String(i)),a&&n.append("search",a),r&&n.append("status",r),B(`/api/paged-users?${n.toString()}`,{errorMessage:"Failed to get paged users"})},Ce=()=>{const s=W(),[i,a]=c.useState(1),[r,n]=c.useState(O()),[t,o]=c.useState(k.Active),[d,C]=c.useState(""),[x,E]=c.useState(null),v=l=>{a(1),n(l)},U=ae(i,r,d,t==null?void 0:t.toString()),{data:j,error:y,isLoading:P,refetch:b}=z(["pagedUsers",i,r,t,d],()=>U(),{enabled:s.isAuthenticated}),p=l=>{E(l)};return P?e.jsx(I,{}):y?e.jsx(M,{error:y,title:"Unable to fetch users",onDismiss:()=>b()}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"mb-4",children:"Users"}),x&&e.jsx(re,{user:x,setUser:E,onUserWasUpdated:()=>b()}),j&&e.jsxs(e.Fragment,{children:[e.jsx(_,{searchText:d,onSearch:C,children:e.jsx(G,{status:t,setStatus:o})}),e.jsxs($,{responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Handle"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Email confirmed"}),e.jsx("th",{children:"Registered"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Roles"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:j.items.map(l=>e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:l.handle}),e.jsx("td",{children:l.email}),e.jsx("td",{children:l.emailConfirmed?"YES":"NO"}),e.jsx("td",{children:l.registered?"YES":"NO"}),e.jsx("td",{children:q(k[l.status])}),e.jsx("td",{children:l.roles.join(", ")}),e.jsx("td",{children:e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(S,{outline:!0,className:"float-end",onClick:()=>p(l),children:e.jsx(K,{})})})})]},l.id))})]}),e.jsx(T,{pagedResult:j,onPageSelected:a,perPage:r,onPerPageSelected:v})]})]})};export{Ce as default};
