import{j as e,u as z,r as u,B as P,Q as E,g as R,b as W,A as B,w as T,e as V,d as $,p as Q,I as D,C as G}from"./index-660d126b.js";import{H}from"./Helmet-6a411193.js";import{R as M,C}from"./Col-95c4f5db.js";import{A as K}from"./Alert-e5aa8ee6.js";import{S as U,F as q}from"./FilterPanel-c54551cb.js";import{F as y,L as w}from"./Label-4c846b7c.js";import{I as F}from"./Input-fbe04029.js";import{I as X,X as Y}from"./x-a6635ec2.js";import{c as J}from"./currency-symbol-map-2963a5a3.js";import{i as L}from"./isNullOrWhiteSpace-3eb5922e.js";import{M as Z,a as _,b as ee}from"./ModalBody-ed0339e4.js";import{M as se}from"./ModalFooter-601f690c.js";import{L as re}from"./Listing-d0e6d54d.js";import{g as te,P as ae}from"./Pagination-a5b0422f.js";import{S as oe}from"./Spinner-f4f30a5b.js";import{t as ne}from"./toQuery-95abe6fa.js";import"./floating-ui.dom-b7824c3c.js";import"./jewelleryClasses-470ac029.js";import"./Card-0007d0c0.js";import"./CardBody-ff2bad32.js";import"./SelectQuantity-11f15c27.js";import"./types-9dadba29.js";import"./Currency-c9219b6e.js";import"./strings-3be1ab26.js";import"./UnitType-2ae5b94b.js";import"./Badge-d2d27bae.js";import"./CardImg-423f9db5.js";import"./ButtonGroup-07933ff6.js";const ce=({currencies:t,onChange:s})=>{const o=Object.entries(J).map(([r,c])=>({value:r,label:r,symbol:c})),n=r=>{s(r.map(c=>c.value))},i={multiValue:r=>({...r,backgroundColor:"#e9ecef"}),multiValueLabel:r=>({...r,color:"#495057"}),multiValueRemove:r=>({...r,color:"#495057",":hover":{backgroundColor:"#ced4da",color:"#495057"}})},h=({value:r,symbol:c})=>e.jsxs("div",{children:[r," ",c]});return e.jsxs(y,{children:[e.jsx(w,{for:"currencySelect",children:"Currencies"}),e.jsx(U,{id:"currencySelect",isMulti:!0,options:o,value:o.filter(r=>t.includes(r.value)),onChange:n,styles:i,formatOptionLabel:h,placeholder:"Select currencies..."})]})},ie=()=>z("/api/save-search",{errorMessage:"Failed to save search"}),le=({searchToSave:t,onClose:s})=>{const[o,n]=u.useState(!1),i=[t.handle,t.search].map(l=>(l||"").trim()).filter(l=>!L(l)).join(" "),h=i.length>32?i.substring(0,32).split(" ").slice(0,-1).join(" ")+"...":i,[r,c]=u.useState(h),f=ie(),v=async()=>{n(!0);const l={...t,name:r};try{await f(l),E.success("Search was saved"),window.dispatchEvent(new Event("savedSearchesChanged")),s()}catch(p){E.error(R(p))}finally{n(!1)}};return e.jsxs(Z,{isOpen:!0,toggle:s,size:"lg",children:[e.jsx(_,{toggle:s,children:"Save search"}),e.jsxs(ee,{children:[e.jsxs(y,{children:[e.jsx(w,{for:"searchName",children:"Search name"}),e.jsx(F,{id:"searchName",type:"text",placeholder:"Search name",value:r,onChange:l=>c(l.target.value),maxLength:32,className:"mb-3"})]}),e.jsxs(y,{children:[e.jsx(w,{className:"fw-bold",children:"Search"}),e.jsx("p",{children:t.name})]}),e.jsxs(y,{children:[e.jsx(w,{className:"fw-bold",children:"Store"}),e.jsx("p",{children:t.handle})]}),e.jsxs(y,{children:[e.jsx(w,{className:"fw-bold",children:"Include sold"}),e.jsx("p",{children:t.includeSold?"YES":"NO"})]})]}),e.jsxs(se,{children:[e.jsx(P,{color:"secondary",onClick:s,children:"Close"}),e.jsx(P,{color:"primary",onClick:v,disabled:o,children:o?"Submitting...":"Submit"})]})]})};function de(){return new Date().getTimezoneOffset()}const he=({handle:t,filters:s,onFilterChange:o})=>{const{isAuthenticated:n}=W(),[i,h]=u.useState(s.search||""),[r,c]=u.useState(null),f=!L(s.search)||!L(s.category)||s.condition&&s.condition.length>0||s.era&&s.era.length>0||s.jewellery&&s.jewellery.length>0,v=n&&f,l=()=>{c({id:null,timezoneOffset:de(),name:"",handle:t,search:s.search,category:s.category,condition:s.condition,era:s.era,jewellery:s.jewellery,includeSold:s.includeSold})},p=()=>{o({search:i})},k=()=>{h(""),o({search:""})},x=d=>{d.key==="Enter"&&p()};return e.jsxs(e.Fragment,{children:[r&&e.jsx(le,{onClose:()=>c(null),searchToSave:r}),e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex-grow-1",style:{minWidth:"200px",maxWidth:"400px"},children:e.jsxs(X,{children:[e.jsx(P,{id:"ClearSearch",onClick:k,children:e.jsx(Y,{size:18})}),e.jsx(F,{value:i,onChange:d=>h(d.target.value),onKeyPress:x,placeholder:"Search for..."}),e.jsx(P,{color:"primary",onClick:p,children:e.jsx(B,{size:18})})]})}),e.jsx("div",{children:e.jsxs(y,{check:!0,className:"mb-0",children:[e.jsx(F,{type:"checkbox",id:"showSoldItems",checked:s.includeSold||!1,onChange:d=>o({includeSold:d.target.checked})}),e.jsx(w,{check:!0,for:"showSoldItems",className:"mb-0",children:"Show sold items"})]})}),e.jsx("div",{style:{minWidth:"200px",maxWidth:"300px"},children:e.jsx(ce,{currencies:s.currencies||[],onChange:d=>o({currencies:d})})}),v&&e.jsx("div",{children:e.jsx(P,{size:"sm",onClick:l,children:"Save this search"})})]})]})},me=t=>{const{filters:s={category:"",eras:[],conditions:[],jewellery:[]},...o}=t,n=ne({...o,...s});return T(`/api/browse?${n}`,{errorMessage:"Failed to browse items"})},$e=({handle:t})=>{const s=V(),o=$(),[n,i]=u.useState({}),[h,r]=u.useState(1),[c,f]=u.useState(te()),v=a=>{r(1),f(a)},l=()=>{var b,g,N,j;const a=new URLSearchParams(o.search);return{category:a.get("category")||void 0,condition:((b=a.get("condition"))==null?void 0:b.split(","))||void 0,era:((g=a.get("era"))==null?void 0:g.split(","))||void 0,jewellery:((N=a.get("jewellery"))==null?void 0:N.split(","))||void 0,search:a.get("search")||void 0,includeSold:a.get("includeSold")==="true"||void 0,currencies:((j=a.get("currencies"))==null?void 0:j.split(","))||void 0}};u.useEffect(()=>{i(l()),r(1)},[o.search]);const p=a=>{const b={...n,...a};i(b);const g=new URLSearchParams;Object.entries(b).forEach(([j,S])=>{S&&j!=="handle"&&(Array.isArray(S)?g.set(j,S.join(",")):typeof S=="boolean"?g.set(j,S.toString()):g.set(j,S))});const N=g.toString();s({search:N})},k=me({handle:t==="@everyone"?void 0:t,filters:n,page:h,perPage:c}),{data:x,error:d,isLoading:A}=Q(["browse",n,h,c],k,{keepPreviousData:!0}),m=D.find(a=>a.path===n.category),O="Vintage and Pre-Owned"+(m?` - ${m.value}`:" - Marketplace"),I="Vintage and Pre-Owned"+(m?` - ${m.value} - ${m.explanation}`:" - Marketplace");return e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx("title",{children:O}),e.jsx("meta",{property:"og:title",content:O}),e.jsx("meta",{property:"og:description",content:I}),e.jsx("meta",{property:"og:url",content:window.location.href}),e.jsx("meta",{property:"og:type",content:"website"})]}),e.jsxs(G,{fluid:!0,children:[e.jsx(M,{className:"mb-3",children:e.jsx(C,{xs:"12",children:e.jsxs("h1",{className:"text-center",children:["Marketplace / ",(m==null?void 0:m.value)??"..."]})})}),e.jsx(M,{className:"mb-3 align-items-center",children:e.jsx(C,{xs:"12",md:"9",children:e.jsx(he,{handle:t==="@everyone"?null:t,filters:n,onFilterChange:p})})}),e.jsxs(M,{children:[e.jsx(C,{xs:"12",md:"3",children:e.jsx(q,{onFilterChange:p,filters:n})}),e.jsxs(C,{xs:"12",md:"9",children:[A?e.jsx(oe,{}):d?e.jsx(K,{color:"danger",children:R(d)}):e.jsx(M,{children:x==null?void 0:x.items.map(a=>e.jsx(C,{xs:"12",sm:"6",lg:"4",xl:"3",className:"mb-4",children:e.jsx(re,{item:a,showCheckout:!1})},a.id))}),x&&e.jsx(ae,{pagedResult:x,onPageSelected:r,perPage:c,onPerPageSelected:v})]})]})]})]})};export{$e as default};
