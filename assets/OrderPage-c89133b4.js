import{r as y,j as e,B as p,w as I,u as v,n as R,p as T,C as A,e as F,Q as N}from"./index-660d126b.js";import{S as M}from"./Spinner-f4f30a5b.js";import{E as S}from"./ErrorDisplay-52780e50.js";import{C as d,n as E,f as m}from"./Currency-c9219b6e.js";import{p as L,a as B}from"./UnitType-2ae5b94b.js";import{g as Q}from"./getAddressTypeLabel-b6416573.js";import{R as D,C as K}from"./Col-95c4f5db.js";import{T as H}from"./Table-cbaeae2a.js";import{F as f,L as $}from"./Label-4c846b7c.js";import{I as O}from"./Input-fbe04029.js";import{A as h}from"./Alert-e5aa8ee6.js";import{O as g,U as k}from"./types-9dadba29.js";import{a as U,b as W}from"./strings-3be1ab26.js";import{i as P}from"./isNullOrWhiteSpace-3eb5922e.js";import{u as b}from"./useMutation-e7c8b84b.js";import"./currency-symbol-map-2963a5a3.js";const Y=({color:n,size:r,actionText:t,cancelActionText:s,children:i})=>{const[c,o]=y.useState(!1);return c?e.jsxs(e.Fragment,{children:[i,e.jsx(p,{size:r||void 0,color:"secondary",onClick:()=>{o(!1)},children:s||"Cancel"})]}):e.jsx(p,{size:r||void 0,color:n,onClick:()=>{o(!0)},children:t})};function G(n,r,t){const s=Object.entries(n),i=s.findIndex(u=>u[1]===r);if(i===-1)return U(r);const o=s[i][0];return t&&o in t?U(t[o]):W(String(o))}const V=n=>I(`/api/orders/${n}`,{errorMessage:"Failed to get order"}),_=()=>v("/api/orders/create-invoice",{errorMessage:"Failed to create invoice"}),z=()=>v("/api/paid",{errorMessage:"Failed to mark order as paid"}),q=()=>v("/api/shipped",{errorMessage:"Failed to mark order as shipped"}),J=()=>v("/api/orders/delete",{errorMessage:"Failed to delete order"}),X=({item:n})=>{const r=n.photos.find(t=>t.main);return r?e.jsx("div",{className:"thumbnail",children:e.jsx("a",{href:r.imageUrlLg,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:r.imageUrlSm,alt:n.name,style:{maxWidth:"100px"},className:"img-fluid"})})}):null},w=({value:n,onChange:r,...t})=>{const s=i=>{const c=i.target.value===""?null:parseFloat(i.target.value);r&&r(c)};return e.jsx(O,{onChange:s,value:n??"",step:"0.01",min:"0",...t,type:"number"})},Z=({order:n})=>{const{store:r}=n;return n.orderStatus===g.New?e.jsxs(h,{color:"success",className:"no-print p-2",children:["Your order has been placed. ",r.storeKeeperName," will now calculate the shipping and order total. Once this has been done you will get an invoice which you can then pay with online banking."]}):n.orderStatus===g.Invoiced?e.jsxs(h,{color:"success",className:"no-print p-2",children:["Your order shipping and total has been calculated (",e.jsx("strong",{children:E(n.total).format("$0,0.00")}),"), please pay ",r.storeKeeperName," using online banking with reference ",e.jsx("strong",{children:n.invoiceRef}),".",e.jsx("br",{}),r.facebookPageUrl&&e.jsxs(e.Fragment,{children:["If you've not ordered before you can"," ",e.jsx("abbr",{title:"Private Message",children:"PM"})," ",r.storeKeeperName," on the"," ",e.jsx("a",{target:"_blank",href:r.facebookPageUrl,children:r.facebookPageName})," ","page for payment details.",e.jsx("br",{})]}),"To pay with paypal send payment to"," ",e.jsx("strong",{children:r.storeEmail})," using the invoice ref"," ",e.jsx("strong",{children:n.invoiceRef})," in the special instructions to seller."]}):n.orderStatus===g.Paid?e.jsxs(h,{color:"success",className:"no-print p-2",children:[r.storeKeeperName," has received your payment and will be packing your items shortly."]}):n.orderStatus===g.Shipped?e.jsx(h,{color:"success",className:"no-print p-2",children:"Your items have been shipped."}):null},ee=({order:n})=>P(n.publicNote)?null:e.jsxs(h,{color:"success",className:"no-print p-2",children:[e.jsx("strong",{children:"Order note: "}),n.publicNote]}),ne=({order:n})=>n.isStoreAdmin?e.jsxs("p",{className:"print-only p-2",children:["Packing slip - (this is not an invoice)",n.store.facebookPageName&&n.store.facebookPageUrl&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"Facebook: ",n.store.facebookPageName," ",n.store.facebookPageUrl]}),n.store.twitterHandle&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"Twitter: ",n.store.twitterHandle]}),e.jsx("br",{}),"Website: ",location.origin]}):null,te=n=>n.isStoreAdmin?n.orderStatus:4,se=({order:n})=>{const r=n.addresses.map((t,s)=>{const i=[t.addressLine1,t.addressLine2,t.city,t.stateOrProvince,t.postalCode,t.country].filter(c=>!P(c));return!P(n.deliveryNote)&&t.isShippingAddress&&(i.push(""),i.push("Delivery note: "+n.deliveryNote)),e.jsxs("span",{children:[e.jsx("div",{children:e.jsx("strong",{children:Q(t)})}),e.jsx("p",{children:i.map((c,o)=>e.jsxs("span",{children:[c,e.jsx("br",{})]},o+c))})]},`${s}_${t.id}`)});return e.jsx(e.Fragment,{children:r})},re=({orderItem:n})=>n.item.unitPricing===k.ByUnit?e.jsxs("span",{children:[n.purchaseQuantity," ",L(n.item.unitType,n.purchaseQuantity),"Â @"," ",e.jsx(d,{val:n.item.unitPrice,currency:n.item.currency})," ","per ",G(B,n.item.unitType)]}):n.item.unitPricing===k.MultipleItems?e.jsxs("span",{children:[n.purchaseQuantity," @"," ",e.jsx(d,{val:n.item.unitPrice,currency:n.item.currency})," ","each"]}):e.jsx("span",{children:n.purchaseQuantity}),ie=({editMode:n,order:r,setOrder:t})=>n===0||n===1||n===2||n===3?e.jsxs("tr",{className:"no-print",children:[e.jsx("td",{className:"col-100"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{colSpan:3,children:e.jsxs(f,{children:[e.jsx($,{for:"PrivateNote",children:e.jsx("strong",{children:"Private note"})}),n===3?e.jsx("p",{children:r.privateNote}):e.jsx(O,{type:"textarea",value:r.privateNote,onChange:s=>{t({...r,privateNote:s.target.value})},id:"PrivateNote"})]})})]}):null,ce=({editMode:n,order:r,setOrder:t})=>n===0||n===1||n===2?e.jsxs("tr",{className:"no-print",children:[e.jsx("td",{className:"col-100"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{colSpan:3,children:e.jsxs(f,{children:[e.jsx($,{for:"PublicNote",children:e.jsx("strong",{children:"Public note"})}),e.jsx(O,{type:"textarea",value:r.publicNote,onChange:s=>{t({...r,publicNote:s.target.value})},id:"PublicNote"})]})})]}):null,x=({children:n})=>e.jsxs("tr",{className:"no-print",children:[e.jsx("td",{className:"col-100"}),e.jsx("td",{colSpan:3}),e.jsx("td",{children:n}),e.jsx("td",{colSpan:2})]}),oe=({setApiError:n,editMode:r,order:t,fetchOrder:s,orderTotal:i})=>{const c=b(_()),o=async()=>{try{await c.mutateAsync({id:t.id,reservedUntilUtc:t.reservedUntilUtc,discount:t.discount,shipping:t.shipping,privateNote:t.privateNote,publicNote:t.publicNote}),N.success("Invoice created"),s()}catch(u){n(u)}};return r===0&&i>0?e.jsx(x,{children:e.jsx(p,{color:"primary",onClick:()=>o(),disabled:c.isLoading,children:"Create invoice"})}):null},ae=({setApiError:n,editMode:r,order:t,fetchOrder:s})=>{const i=b(z());if(r!==1)return null;const c=async()=>{try{await i.mutateAsync({id:t.id,privateNote:t.privateNote,publicNote:t.publicNote}),N.success("Order paid"),s()}catch(j){n(j)}},o=`Vintage and pre-owned invoice ref ${t.invoiceRef}`,u=`${location.origin}/stores/${t.store.handle}/order/${t.id}`,l=[encodeURIComponent(`Hi ${t.firstName}`),"",encodeURIComponent(`Here is a link to your invoice from ${t.store.name} ${t.store.handle}`),"",encodeURIComponent(u),"",encodeURIComponent("Order details"),encodeURIComponent(`Items count ${t.itemCount}`),encodeURIComponent(`Items total ${m(t.itemsTotal,t.currency)}`),encodeURIComponent(`Discount ${m(t.discount,t.currency)}`),encodeURIComponent(`Shipping ${m(t.shipping,t.currency)}`),encodeURIComponent(`Total ${m(t.total,t.currency)}`),"",encodeURIComponent(`Please use reference ${t.invoiceRef} when paying via internet banking`),"",encodeURIComponent(`Thanks ${t.store.storeKeeperName}`)].join("%0D%0A");return e.jsxs(e.Fragment,{children:[e.jsx(x,{children:e.jsx(p,{color:"primary",href:`mailto:${t.email}?subject=${encodeURIComponent(o)}&body=${l}`,children:"Email invoice"})}),e.jsx(x,{children:e.jsx(p,{color:"primary",onClick:()=>c(),disabled:i.isLoading,children:"Mark order as paid"})})]})},le=({setApiError:n,editMode:r,order:t,fetchOrder:s})=>{const i=b(q()),c=async()=>{try{await i.mutateAsync({id:t.id,privateNote:t.privateNote,publicNote:t.publicNote}),N.success("Order shipped"),s()}catch(o){n(o)}};return r===1||r===2?e.jsx(x,{children:e.jsx(p,{color:"primary",onClick:()=>c(),disabled:i.isLoading,children:"Mark order as shipped"})}):null},de=({setApiError:n,editMode:r,order:t})=>{const s=F(),i=b(J());if(r!==0)return null;const c=async()=>{try{await i.mutateAsync({id:t.id}),N.success("Order cancelled"),s(`/stores/${t.store.handle}`)}catch(o){n(o)}};return e.jsx(x,{children:e.jsx(Y,{color:"danger",actionText:"Are you sure you want to cancel this order?",cancelActionText:"Yes, cancel order",children:e.jsx(p,{color:"danger",disabled:i.isLoading,onClick:c,children:"Cancel order"})})})},ke=()=>{const{id:n}=R(),[r,t]=y.useState(null),[s,i]=y.useState(null),c=V(n||""),{data:o,isLoading:u,error:C}=T(["order",n],c,{enabled:!!n});if(y.useEffect(()=>{o&&i(o)},[o]),u)return e.jsx(M,{});if(C)return e.jsx(S,{error:C});if(!s)return null;const l=te(s),j=s.itemsTotal-(s.discount||0)+(s.shipping||0);return e.jsxs(A,{children:[e.jsx(D,{children:e.jsxs(K,{children:[e.jsxs("h1",{children:["Order ",s.id]}),e.jsx(Z,{order:s}),e.jsx(ee,{order:s}),e.jsx(ne,{order:s}),e.jsxs(H,{responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Total"})]})}),e.jsxs("tbody",{children:[s.items.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"col-100",children:e.jsx(X,{item:a.item})}),e.jsx("td",{children:a.item.name}),e.jsx("td",{children:e.jsx(re,{orderItem:a})}),e.jsx("td",{children:e.jsx(d,{val:a.item.unitPrice,currency:a.item.currency})}),e.jsx("td",{children:e.jsx(d,{val:(a.item.unitPrice??0)*a.purchaseQuantity,currency:a.item.currency})})]},a.id)),e.jsxs("tr",{children:[e.jsx("td",{className:"col-100"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("strong",{children:"Items total"})}),e.jsx("td",{children:e.jsx(d,{val:s.itemsTotal,currency:s.currency})})]}),e.jsxs("tr",{className:"no-print",children:[e.jsx("td",{className:"col-100"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("strong",{children:"Discount"})}),e.jsx("td",{children:l===0?e.jsx(f,{children:e.jsx(w,{value:s.discount,onChange:a=>{i({...s,discount:a??0})},id:"Discount"})}):e.jsx(d,{val:s.discount||0,currency:s.currency})})]}),e.jsxs("tr",{className:"no-print",children:[e.jsx("td",{className:"col-100"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("strong",{children:"Shipping"})}),e.jsx("td",{children:l===0?e.jsx(f,{children:e.jsx(w,{value:s.shipping,onChange:a=>{i({...s,shipping:a??0})},id:"Shipping"})}):e.jsx(d,{val:s.shipping||0,currency:s.currency})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"col-100"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("strong",{children:"Order total"})}),e.jsx("td",{children:e.jsx("strong",{children:e.jsx(d,{val:j,currency:s.currency})})})]}),e.jsx(ie,{editMode:l,order:s,setOrder:i}),e.jsx(ce,{editMode:l,order:s,setOrder:i}),e.jsx(oe,{setApiError:t,editMode:l,order:s,fetchOrder:()=>{},orderTotal:j}),e.jsx(ae,{setApiError:t,editMode:l,order:s,fetchOrder:()=>{}}),e.jsx(le,{setApiError:t,editMode:l,order:s,fetchOrder:()=>{}}),e.jsx(de,{setApiError:t,editMode:l,order:s})]})]}),e.jsx(se,{order:s})]})}),e.jsx(S,{error:r})]})};export{ke as default};
