import{i as C,r as w,j as v,R as B,B as M,k as L,h as T,d as I,e as Y,b as P}from"./index-660d126b.js";import{u as E}from"./useSocialAuthLogin-c406f09d.js";import{L as U}from"./types-9dadba29.js";import{E as D}from"./ErrorDisplay-52780e50.js";const G=({className:u,btnText:h,onError:c,onSocialAuthLogin:i})=>{const{auth:o}=C(),[e,t]=w.useState(!1),s=E();w.useEffect(()=>{(function(g,A,a){const r=g.getElementsByTagName(A)[0];let l=g.getElementById(a);g.getElementById(a)||(l=g.createElement(A),l.id=a,l.src="https://connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(l,r))})(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){window.FB.init({appId:o.facebook.appId,cookie:!0,xfbml:!0,version:"v16.0"})}},[o.facebook.appId]);const f=async g=>{const A={provider:U.Facebook,token:g.accessToken};t(!0);try{const a=await s(A);i(a)}catch(a){c(a)}finally{t(!1)}},p=()=>{window.FB.login(function(g){g.authResponse?(console.log("FacebookLoginButton.onClick"),console.log(g),f({accessToken:g.authResponse.accessToken})):console.log("User cancelled login or did not fully authorize.")},{scope:"public_profile,email"})},d={height:"18px",width:"24px"},m=v.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 216 216",style:d,color:"#FFFFFF",children:v.jsx("path",{fill:"#FFFFFF",d:"M204.1 0H11.9C5.3 0 0 5.3 0 11.9v192.2c0 6.6 5.3 11.9 11.9 11.9h103.5v-83.6H87.2V99.8h28.1v-24c0-27.9 17-43.1 41.9-43.1 11.9 0 22.2.9 25.2 1.3v29.2h-17.3c-13.5 0-16.2 6.4-16.2 15.9v20.8h32.3l-4.2 32.6h-28V216h55c6.6 0 11.9-5.3 11.9-11.9V11.9C216 5.3 210.7 0 204.1 0z"})});return v.jsxs("button",{className:`${u} btn btn-primary`,onClick:p,disabled:e,children:[m,h]})};function N(u={}){const{nonce:h,onScriptLoadSuccess:c,onScriptLoadError:i}=u,[o,e]=w.useState(!1),t=w.useRef(c);t.current=c;const s=w.useRef(i);return s.current=i,w.useEffect(()=>{const f=document.createElement("script");return f.src="https://accounts.google.com/gsi/client",f.async=!0,f.defer=!0,f.nonce=h,f.onload=()=>{var p;e(!0),(p=t.current)===null||p===void 0||p.call(t)},f.onerror=()=>{var p;e(!1),(p=s.current)===null||p===void 0||p.call(s)},document.body.appendChild(f),()=>{document.body.removeChild(f)}},[h]),o}const O=w.createContext(null);function K({clientId:u,nonce:h,onScriptLoadSuccess:c,onScriptLoadError:i,children:o}){const e=N({nonce:h,onScriptLoadSuccess:c,onScriptLoadError:i}),t=w.useMemo(()=>({clientId:u,scriptLoadedSuccessfully:e}),[u,e]);return B.createElement(O.Provider,{value:t},o)}function V(){const u=w.useContext(O);if(!u)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return u}function Q({flow:u="implicit",scope:h="",onSuccess:c,onError:i,onNonOAuthError:o,overrideScope:e,state:t,...s}){const{clientId:f,scriptLoadedSuccessfully:p}=V(),d=w.useRef(),m=w.useRef(c);m.current=c;const g=w.useRef(i);g.current=i;const A=w.useRef(o);A.current=o,w.useEffect(()=>{var l,n;if(!p)return;const b=u==="implicit"?"initTokenClient":"initCodeClient",_=(n=(l=window==null?void 0:window.google)===null||l===void 0?void 0:l.accounts)===null||n===void 0?void 0:n.oauth2[b]({client_id:f,scope:e?h:`openid profile email ${h}`,callback:y=>{var x,S;if(y.error)return(x=g.current)===null||x===void 0?void 0:x.call(g,y);(S=m.current)===null||S===void 0||S.call(m,y)},error_callback:y=>{var x;(x=A.current)===null||x===void 0||x.call(A,y)},state:t,...s});d.current=_},[f,p,u,h,t]);const a=w.useCallback(l=>{var n;return(n=d.current)===null||n===void 0?void 0:n.requestAccessToken(l)},[]),r=w.useCallback(()=>{var l;return(l=d.current)===null||l===void 0?void 0:l.requestCode()},[]);return u==="implicit"?a:r}const z=({className:u,btnText:h,onSocialAuthLogin:c,onError:i})=>{const[o,e]=w.useState(!1),t=E(),s=d=>{const m={provider:U.Google,token:d.access_token};e(!0),t(m).then(c).catch(i).finally(()=>e(!1))},f=Q({onSuccess:d=>s(d),onError:d=>{console.log("Google login failed"),i(d)}}),p=v.jsx("img",{width:"22px",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAmCAYAAACoPemuAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAALXSURBVFhH7ZVfSFNRHMe/u3dryzm32lTMKYY0pBRLRUsySpOeAh8iGj0UZCFFEVHZkyRBfyToxTcfQqiHHuzBerCIEvQh6A+UIWkrM2Q4sc01Hdvudm9n2xEd2ThnovhwP3C4v9/v7uFzz+/8zjQKARsQgT43HKoYL6oYL6oYL6oYL6u6+aWxUYSePUV0woWYewqKFIFozYWuYjf0B5uxqWYv/SU/GYnFPNMIdHVC+vSBVlZGW16JnPabEAsKaYUdbjFpdAT+jmtQ5ry0kh5dVS0sXd00Y4dLLDY7A1+rE8p8gFaSiPZiaEsdUGQZ0e/jkElb42h3lMFMpARTTiLngUts7vp5SB/f04xMTm4esi+1Q7+vgVaShIfeIDTQD9ONzoyk4jCLKb5hBB8eQ/CFnWydAMFqg+VBD8Rt/OeHBebrQp5+BH2lF6ZT3yBYIjCeubBmUnGYdyz6tgpY+JKI5agVusNT0IhiIl/kTn+YRiuz3yGioUxLs/Swiw3aSAv/JBNzPbQ1g8l4GU23F2i0Mi3VWlw8oqdZetb15o9EacAAu5ihiAZAKDiBmByj2RL2rZqUlW/W0DdJLMbUPB3sh99Uk3iOR3Nw0rMTA5NDiXw5vW1ZKet4nY6+SVJsZd8HdrF8J56HinB2rgFu2Yjuz48xNe+hb//FH1TQ906iGTnMZNWWpg5LOpjFDLZGvDKeBvmbTuSzIR/aXndgyL104S4y5pvA5Sc/4fYtzVVTuQhzFnsruW7+meBvnBi4goCUOn3F2QVwbNkOUSNgMuDGV98PaGQDDJ5z0AWrYSSD2NO6mZw59lZyicUZmR3H1eF78Ib9tJKe/HALbh1wYk8JexvjsH8CpcLmQG/zXVTn7aKV/1NiKsT9o/XcUnG4d2w5o14X+lwv4fL/IoMwjXAsAqvBgnKrA432OhwiSyDtzYRVia0lmX3OOqCK8aKK8aKK8aKK8QH8Bf9b+5uOTYk3AAAAAElFTkSuQmCC",alt:""});return v.jsxs(M,{className:u,onClick:()=>f(),disabled:o,children:[p,v.jsx("span",{className:"ms-2",children:h})]})},H=({className:u,btnText:h,onError:c,onSocialAuthLogin:i})=>{const{auth:o}=C();return v.jsx(K,{clientId:o.google.clientId,children:v.jsx(z,{className:u,btnText:h,onSocialAuthLogin:i,onError:c})})};var R={exports:{}};(function(u,h){(function(i,o){u.exports=o(w)})(L,function(c){return function(i){var o={};function e(t){if(o[t])return o[t].exports;var s=o[t]={i:t,l:!1,exports:{}};return i[t].call(s.exports,s,s.exports,e),s.l=!0,s.exports}return e.m=i,e.c=o,e.i=function(t){return t},e.d=function(t,s,f){e.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:f})},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},e.p="",e(e.s=4)}([,function(i,o,e){Object.defineProperty(o,"__esModule",{value:!0});var t=e(2),s=e.n(t),f=function(){var a=typeof Symbol=="function"&&Symbol.for&&Symbol.for("react.element")||60103;return function(l,n,b,_){var y=l&&l.defaultProps,x=arguments.length-3;if(!n&&x!==0&&(n={}),n&&y)for(var S in y)n[S]===void 0&&(n[S]=y[S]);else n||(n=y||{});if(x===1)n.children=_;else if(x>1){for(var k=Array(x),j=0;j<x;j++)k[j]=arguments[j+3];n.children=k}return{$$typeof:a,type:l,key:b===void 0?null:""+b,ref:null,props:n,_owner:null}}}(),p=function(){function a(r,l){for(var n=0;n<l.length;n++){var b=l[n];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(r,b.key,b)}}return function(r,l,n){return l&&a(r.prototype,l),n&&a(r,n),r}}();function d(a,r){if(!(a instanceof r))throw new TypeError("Cannot call a class as a function")}function m(a,r){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:a}function g(a,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);a.prototype=Object.create(r&&r.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(a,r):a.__proto__=r)}var A=function(a){g(r,a);function r(l){d(this,r);var n=m(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,l));if(n.startOAuth=n.startOAuth.bind(n),n.getOAuthUrl=n.getOAuthUrl.bind(n),!n.props.clientId)throw new Error("invalid clientId provided for react-ms-login");if(!n.props.redirectUri)throw new Error("invalid redirectUri provided for react-ms-login");return n.state={clientId:n.props.clientId,redirectUri:n.props.redirectUri,scopes:n.props.scopes||["user.read"],responseType:n.props.responseType||"token"},n.oauthUrl="https://login.microsoftonline.com/common/oauth2/v2.0/authorize",n}return p(r,[{key:"getOAuthUrl",value:function(){var n=encodeURIComponent(this.state.scopes.join(" ")),b=this.oauthUrl+"?client_id="+this.state.clientId+"&response_type="+this.state.responseType+("&redirect_uri="+encodeURIComponent(this.state.redirectUri))+("&scope="+n+"&response_mode=fragment");return b}},{key:"startOAuth",value:function(){var n=function(y,x,S,k){var j=screen.width/2-S/2,F=screen.height/2-k/2;return window.open(y,x,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+S+", height="+k+", top="+F+", left="+j)},b=(function(_){this.props.handleLogin(_)}).bind(this);window.authScope={authCompletedCB:b},n(this.getOAuthUrl(),"Microsoft Sign In",600,750)}},{key:"render",value:function(){var n="btn-microsoft-login "+this.props.cssClass,b="Sign in with Microsoft";return this.props.btnContent&&(typeof this.props.btnContent=="function"?b=f(this.props.btnContent,{}):b=this.props.btnContent),f("button",{type:"button",className:n,onClick:this.startOAuth},void 0,b)}}]),r}(s.a.Component);o.default=A},function(i,o){i.exports=c},,function(i,o,e){i.exports=e(1)}])})})(R);var Z=R.exports;const W=T(Z);var $={exports:{}};(function(u,h){(function(i,o){u.exports=o()})(L,function(){return function(c){var i={};function o(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return c[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}return o.m=c,o.c=i,o.i=function(e){return e},o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(c,i){window.ReactLoginMS={authComplete:o};function o(){function e(){return window.location.hash.indexOf("#")===0?t(window.location.hash.substr(1)):{}}function t(f){var p={},d,m,g,A,a,r,l;if(f===null)return p;d=f.split("&");for(var n=0;n<d.length;n++)m=d[n],g=m.indexOf("="),g===-1?(A=m,a=null):(A=m.substr(0,g),a=m.substr(g+1)),r=decodeURIComponent(A),l=decodeURIComponent(a),p[r]=l;return p}var s=e();window.location.hash=s.state||"",window.opener.authScope.authCompletedCB(s),window.close()}},,,function(c,i,o){c.exports=o(0)}])})})($);function q(...u){return(u.length===1&&Array.isArray(u[0])?u[0]:u).map(c=>c.replace(/(^\/|\/$)/g,"")).filter(c=>c!=="").join("/")}const J=({className:u,btnText:h})=>{const{auth:c}=C(),i=v.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"21",height:"21",viewBox:"0 0 21 21",children:[v.jsx("title",{children:"MS-SymbolLockup"}),v.jsx("rect",{x:"1",y:"1",width:"9",height:"9",fill:"#f25022"}),v.jsx("rect",{x:"1",y:"11",width:"9",height:"9",fill:"#00a4ef"}),v.jsx("rect",{x:"11",y:"1",width:"9",height:"9",fill:"#7fba00"}),v.jsx("rect",{x:"11",y:"11",width:"9",height:"9",fill:"#ffb900"})]}),o=`${location.protocol}//${location.hostname}${location.port?":"+location.port:""}`;return v.jsx(W,{clientId:c.microsoft.clientId,redirectUri:q(o,"ms_auth"),scopes:["user.read"],cssClass:`btn ${u}`,btnContent:v.jsxs(v.Fragment,{children:[i,v.jsx("span",{className:"ms-2",children:h})]})})},oe=({registration:u})=>{const{auth:h}=C(),[c,i]=w.useState(null),{state:o}=I(),e=Y(),t=P(),s=d=>{if(d.authError){if(d.authError.error==="invalid_grant"){const{provider:m,token:g,lastName:A,firstName:a,email:r}=d;e("/user-registration-social",{state:{provider:m,token:g,lastName:A,firstName:a,email:r}});return}i(d.authError);return}if(d.authTokens){t.onAuthenticated(d.authTokens);const m=(o==null?void 0:o.redir)||"/";e(m);return}console.error(d),i("Unable to complete login or registration.")},f=d=>{i(d)},p=u?"Continue":"Login";return v.jsxs("div",{className:"align-items-center",children:[h.microsoft.enabled&&v.jsx(J,{className:"btnMicrosoft mb-2",btnText:`${p} with Microsoft`}),h.facebook.enabled&&v.jsx(G,{className:"btnFacebook mb-2",btnText:`${p} with Facebook`,onSocialAuthLogin:s,onError:f}),h.google.enabled&&v.jsx(H,{className:"btnGoogle mb-2",btnText:`${p} with Google`,onSocialAuthLogin:s,onError:f}),c?v.jsx(D,{error:c,onDismiss:()=>i(null)}):null]})};export{oe as S};
