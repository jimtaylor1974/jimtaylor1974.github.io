import{d as f,r as t,u as h,e as d,b as m,j as e,L as g,S as x,Q as p,g as j}from"./index-660d126b.js";import{A as k}from"./Alert-e5aa8ee6.js";import{u as S}from"./useMutation-e7c8b84b.js";function A(){const{search:r}=f();return t.useMemo(()=>new URLSearchParams(r),[r])}const E=()=>h("/api/authenticate-with-token",{errorMessage:"Failed to authenticate with token"}),L=r=>{const s=t.useRef(),a=t.useRef(!1),n=t.useRef(!1),[u,o]=t.useState(0);a.current&&(n.current=!0),t.useEffect(()=>(a.current||(s.current=r(),a.current=!0),o(c=>c+1),()=>{n.current&&s.current&&s.current()}),[])},y=()=>{const r=d(),s=m(),n=A().get("token"),[u,o]=t.useState(null),c=E(),l=S(c,{onSuccess:i=>{s.onAuthenticated(i),p.success("Login successful!"),r("/")},onError:i=>{o(j(i))}});return L(()=>{n?l.mutate({token:n}):o("Invalid token.")}),u?e.jsxs(e.Fragment,{children:[e.jsx(k,{color:"danger mt-3",children:u}),e.jsx("br",{}),e.jsx(g,{to:"/",children:"Home"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-dark",children:"Authenticating."}),e.jsx("div",{className:"spinner-full",children:e.jsx(x,{color:"primary"})})]})};export{y as default};
